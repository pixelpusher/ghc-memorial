
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="" content="">
    <meta name="author" content="Royal Greenwich Heritage Trust">

    <!-- TODO: put icon here -->
    <!-- <link rel="icon" href="../../favicon.ico"> -->

    <title>Profile - Royal Greenwich Heritage Trust</title>

    <!-- Bootstrap core CSS -->

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <!-- Custom styles for this template -->
    <link href="css/main.css" rel="stylesheet">    
      
      
                    <script type="text/javascript">
        // This version is different because it uses the HTTP GET variable (the
        // bit after the ? in the url) to search the database, so you can pass
        // in a single id to search for
        
        // this function extracts the variable names and values from a url
        // such as "http://blahbalh.com/somepage.html?param1=34&param2=blahblah"
        // which gives 'param1' with a value of '34'
        // and 'param2' with a value of 'blahblah'

        // taken from: http://stackoverflow.com/questions/439463/how-to-get-get-and-post-variables-with-jquery
        
        function getQueryParams(qs) {
            qs = qs.split("+").join(" ");
            var params = {},
                tokens,
                re = /[?&]?([^=]+)=([^&]*)/g;
            
            while (tokens = re.exec(qs)) {
                params[decodeURIComponent(tokens[1])]
                    = decodeURIComponent(tokens[2]);
            }

            return params;
        }
                        
                        
                        
            
        //
        // this function returns the GET variables passed in via the url
        //
        var $_GET = getQueryParams(document.location.search);
                        
        var search;
            
        // this function loads (or re-loads) everything from the database.
        var loadDatabase = function()
    	{
            
   
            
            var id = parseInt($_GET['id'],10); // get the id, make sure it is a number!
            
            // check if id is a proper number (NaN means 'Not a Number')
            var idIsGood = !(id == undefined || isNaN(id)); 
        
            search = search || $_GET['s'];
            //console.log(id);
            
            // the Handlebars template for HR leaders.
            var HTemplate;
            
            var query;  // this is what sheetrock will use to search the database
            
            var targetElem; // the html id to load into
            
            var finishedLoading = function() { 
                    targetElem.css('display','block'); 
            };
            
            
            if (!idIsGood) 
            {
                console.log('id was bad');
                // if no id was given, or it was not a number, return all rows
                query = "select %id%, %surname%, %forenames%, %regiment% order by %surname% asc";       
                targetElem = $('#people');
                HTemplate = Handlebars.compile($('#people-template').html());  
                
                $('#next25').css('display', 'block');
            }
            else
            {
                console.log('id was good');
                // if we found the id, do a search
                //query = "select %id%, %surname%, %forenames%, %cemeterymemorial% where %id%="+id+" order by %surname% asc";
                query = "select * where %id%="+id;
                targetElem = $('#person');
                HTemplate = Handlebars.compile($('#person-template').html()); 
            }
            
            
            
            
    		// Define spreadsheet URL.
			var mySpreadsheet = 'https://docs.google.com/spreadsheets/d/10-jmwpMLESgR_tWXdtdEK6TUjfWx_VdE6zRULtnwhJo/pubhtml?gid=1626580285&single=true';
			console.log('loading');
			// Load an entire sheet.
			targetElem.sheetrock({
				url: mySpreadsheet,
                sql: query,                
  				chunkSize: 15, // 300 rows
                headersOff: true,
                rowHandler: HTemplate,
  				loading: $('#loading'),
                userCallback : finishedLoading
			});  
    	};
            
        window.addEventListener('load', loadDatabase);
    </script>
      
      
      
  </head>

  <body>

    <div class="container">
      <div id="headerBar">
          <div id="project-title">
              <h2>Family Stories of the Great War</h2>
          </div>
      </div>
      
      <div class="charproImg">
         <!--<img src="images/Welcome-page.png"> -->
        <div class="charproImgOverlay">
            <h1>Charlton Memorial Profile</h1>
            <!--<h3>Age: 25</h3>!-->
        </div>
          
      </div>
        
        
      <a href="index.html"> <img src="images/Ribbon-Logo.png" id="rghtLogo"/></a>
        
        <hr id="desLine" size="30" width="98%">
        
        
      <div class="row search">
        <div class="col-md-12">
            
         <!--<div id="memorialDes">   
          <p>The memorial to the men of the Army Ordnance Department sits on the wall of building number 37 on the Royal Arsenal. Over 60 men are listed on the memorial. The memorial is a stone tablet and at the bottom of the table, two soldiers stand sideways, facing the names of the fallen, with their heads bowed. Originally there were two identical memorials; the other memorial was situated in the dockyard. At some point it was moved and regrettably vandalised, it presently does not have a home.    </p>
             </div> <!--projDes!-->            
        </div> <!--col-md-6!-->
          
            
          
    
        
            
          <!--<div class="col-md-12 div">   
          </div> <!--divider!-->

          
        <div class="col-md-6  col-md-push-6">
            
           <div id="searchHeader">
               <div id="searchHeadBar">
                    <h2>Search Charlton Memorial</h2>
               </div>
               
            <form action="" id="search-form">
                <fieldset>
                    <input type="text" id="s" name="s" placeholder=""/>
                    <!-- <input type="submit" id="search-submit" value="Search" /> -->
                </fieldset>
            </form>
           </div> <!--searchHeader!-->
                     
        </div> <!--col-md-6!-->          
          
          
       <div class="col-md-6  col-md-pull-6">
           
           
           
           
    <div id="profileInfo">   
              <div id="profileInfoBar"> 
                  <h2>More Information</h2>
              </div>
        <div id="loading"><h5>Loading...</h5></div>      
        <div id="person">
        <!--<h2>Person:</h2>!-->
        <script id="person-template" type="text/x-handlebars-template"> 
        <!--    <div class="more_info"><strong>
                
              {{#if cells.surname}}
                <h4 id="name">Name:</h4>{{cells.surname}}
              {{else}}
                ?
              {{/if}},
              
              {{#if cells.forenames}}
                {{cells.forenames}}
              {{else}}
                ?
              {{/if}} 
                
                
                
              {{#if cells.date_died}}
                <h4 id="date_died">Date Of Death:</h4>{{formatDate cells.date_died}}
              {{else}}
                ?
                {{/if}}
                
                </strong> !-->
                
                
            <!--</div>!-->
            
            
            <div class="info">
                <ul>
                    <li><h4>Name:</h4>{{cells.surname}}, {{cells.forenames}}</li>
                    <li><h4>Age:</h4>
                        {{#if cells.age_at_death}}
                        {{cells.age_at_death}}
                        {{else}} ?
                        {{/if}}
                        </li> 
                    <li><h4>Date of Death:</h4>              
                        {{#if cells.date_died}}
                        {{formatDate cells.date_died}}
                        {{else}}
                        ?
                        {{/if}}
                    </li>
                    <li><h4>Rank:</h4>
                        {{#if cells.rank}}
                        {{cells.rank}}
                        {{else}}
                        ?
                        {{/if}}
                    </li>
                    <li><h4>Regiment:</h4>
                        {{#if cells.regiment}}
                        {{cells.regiment}}
                        {{else}}
                        ?
                        {{/if}}
                    </li>
                </ul>
            </div> <!--info!--> 
        </script>
        </div> <!--person!--> 
          </div> <!--profileInfo!--> 
           

           
                   
           
           
           
            
          <div id="viewMemorial">   
              <div id="memorialBar"> 
                  <h2>View Memorials</h2>
              </div>
          </div> <!--viewMemorial!-->

           <a href="charlton.html">
           <div class="charlton">
               <div class="charltonOverlay">
                   <h2>Charlton, St Luke's</h2>
               </div>
           </div>
            </a>
           
      
           <a href="eltham.html">
           <div class="eltham">
               <div class="elthamOverlay">
                   <h2>Eltham, St John's</h2>
               </div>
           </div>
           </a>
           
           
           <a href="woolwich.html">
           <div class="woolwich">
               <div class="woolwichOverlay">
                   <h2>Woolwich Arsenal</h2>
               </div>
           </div>
           </a>
           
           
       </div> <!--col-md-6!-->
          
         
          
          
      </div> <!--row search!-->

      <div class="footer">
          
         <div id="footerContent"> 
         <!-- <div id="royalGreenwich"> -->
            <img id="heritageTrust" src="images/footerLogo.png" alt="Royal Greenwich Heritage Trust"/>  
         <!-- </div> -->
 
             
             
         <!--  <div id="lotteryFund"> -->
            <img id="lotteryFund" src="images/heritage-lottery-fund.png" alt="Supported by National Lottery Fund"/>
         <!--  </div>  -->
             
             
                  <!-- <div id="royalGreenwich"> -->
            <img id="royalGreenwich" src="images/royalGreenwich.png" alt="Royal Borough of Greenwich"/>  
         <!-- </div> -->
             
             
            <img id="siteCredits" src="images/credits.png" alt="Website created by X.C.Smith & James Alexander Doble" /> 
          
        <p> All content &copy; 2014 Royal Greenwich Heritage Trust </p>
          </div>
          
      </div>

    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

  <!-- Latest compiled and minified JavaScript -->
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	
    
    <!-- Include all compiled plugins (below), or include individual files as needed -->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

      
         <script type="text/javascript">
      
    var defaultText = "Search by Name, Memorial, Personal info";
	var searchBox = document.getElementById("s");
 
	//default text after load
	searchBox.value = defaultText;
 
	//on focus behaviour
	searchBox.onfocus = function() {
		if (this.value == defaultText) {//clear text field
			this.value = '';
		}
	};
 
	//on blur behaviour
	searchBox.onblur = function() {
		if (this.value == "") {//restore default text
			this.value = defaultText;
		}
	};
          
             
    searchBox.onkeydown = function(e) {
        if(e.which == 13) {
        e.preventDefault();
        console.log ("hitEnter");
        var newLocation = "profileCharlton.html?s=" +searchBox.value;
        window.location.assign(newLocation);
        }
    };         
      </script>  
      
      
                <!-- Load jQuery from CloudFlare’s CDN. -->
	<script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.1.2/handlebars.min.js"></script>

    <!-- Load jQuery from CloudFlare’s CDN. -->
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

	<!-- sheetrock for google spreadsheets API -->
    <!--<script src="http://chriszarate.github.io/sheetrock/src/jquery.sheetrock.min.js"></script>!-->

         <script>
    Handlebars.registerHelper("formatDate", function(datetime) {
        // DEBUG
        //console.log(datetime);
        
        
        var theDate = new Date(datetime); // new date from string

        return new Handlebars.SafeString(theDate.getDate() + '/' + (theDate.getMonth() + 1) + '/' + theDate.getFullYear());
            

        
    });
      
    </script> 
      
      
        <script src="./js/jquery.sheetrock.min.js"></script> 
      
      
  </body>
</html>